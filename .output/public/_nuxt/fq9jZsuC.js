import{_ as _e}from"./BzDEtBN7.js";import{_ as le}from"./DKN0q9jN.js";import{_ as Y}from"./BNtHcZP4.js";import{_ as ae}from"./CrKBm7Us.js";import{E as J,D as Q,f as G,r as m,G as ve,Q as ge,g as D,o as p,l as k,w as s,b as l,a,c as S,m as F,d as b,s as xe,t as x,q as te,i as oe,F as ye,C as se,p as K,v as ne,h as be,j as he,n as we}from"./XJk57Xzm.js";import{_ as X}from"./0oq0bqkJ.js";import{_ as ke,a as Ce}from"./t4TcopXV.js";import{_ as $e}from"./Y9Pqjzqe.js";import{_ as ie}from"./7oWaGxPY.js";import{_ as Oe}from"./whFIgR0T.js";import{_ as re}from"./ZSbHdXa8.js";import{_ as ue}from"./viV4BwKR.js";import{u as Z}from"./Cg8Mu8Bz.js";import"./BQdhZYq_.js";import"./DKK-teFl.js";import"./Y56T3AGQ.js";import"./DEmq8X_o.js";import"./B4_BqFOv.js";import"./CV2JBMnn.js";const Ue={class:"flex justify-between items-center w-full border-b border-1 pb-4"},je={class:"flex flex-col items-center justify-between w-full h-full py-2"},Me={key:0,class:"py-4 text-gray-400"},Se={id:"comment-section",class:"w-full h-full max-h-screen overflow-auto px-2 py-2"},Fe={key:0,class:"pb-4"},De={class:"flex gap-2 items-center"},Ve={class:"flex flex-col items-start gap-1"},ze={class:"flex text-gray-700 my-3 text-sm"},Ie={class:"text-gray-700 text-sm"},Pe={key:1,class:"pb-4"},Re={class:"flex gap-2 items-center"},Te={class:"flex flex-col items-start gap-1"},Ae={class:"font-semibold"},Be={class:"flex text-gray-700 my-3 text-sm"},Le={class:"text-gray-700 text-sm"},Ne={class:"flex justify-end border-t border-1 pt-2 gap-2"},qe={__name:"CommentSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object,default:()=>({id:0,price:0,comments:{data:[],total:0},callback:()=>{}})}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:T}){const{updateMerchantOrder:A}=Z();J(),Q();const O=G(),c=N,U=T,g=m(3),C=ve("token").value.user,f=m({user:{fullname:C.fullname,photo:C.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}),h=ge(()=>c.data.comments.data.slice(0,g.value)),_=m(c.isOpen);D(()=>c.isOpen,d=>{_.value=d,d||w()}),D(_,d=>{U("update:isOpen",d)});const w=()=>{_.value=!1,U("hide")},j=d=>{const r=new Date,o=new Date(d),t=Math.floor((r-o)/1e3),u={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};for(const y in u){const v=Math.floor(t/u[y]);if(v>=1)return v===1?`${v} ${y} ago`:`${v} ${y}s ago`}return"just now"},P=d=>{f.value.file_url=d},V=d=>{window.open(d,"_blank")},M=d=>{c.data.comments.data=d,U("refresh",c.data)},B=async d=>{const r=c.data.actions.id,o=c.data.comments.data??[];if(!d.message&&d.file_url&&(d.message="Here I attached a file."),!d.message&&!d.file_url){O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Comment message is required!"});return}o.push(d);try{const{data:t}=await A(r,{comment_json:o});O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),M(o),g.value=o.length,setTimeout(()=>{const u=document.getElementById("comment-section");u.scrollTop=u.scrollHeight},2),f.value={user:{fullname:C.fullname,photo:C.photo},message:"",time:new Date().toISOString(),file_url:"",other_link:"",is_facilitator:!0}}catch(t){console.error("Updating order failed:",t),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(d,r)=>{const o=X,t=se,u=K,y=ne,v=ae,$=Y,z=Oe,R=re,i=ue;return p(),k(i,{modelValue:_.value,"onUpdate:modelValue":r[3]||(r[3]=e=>_.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-full sm:!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:s(()=>[l($,{ui:{base:"h-full",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:s(()=>[a("div",Ue,[a("button",{onClick:w},[l(o,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),r[4]||(r[4]=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Discussions ",-1))]),a("div",je,[c.data.comments.total===0?(p(),S("div",Me," Start Discussion ")):F("",!0),g.value<c.data.comments.total?(p(),k(u,{key:1,block:"",color:"primary",variant:"soft",class:"my-4 bg-blue-100 hover:bg-blue-200",onClick:r[0]||(r[0]=e=>g.value=c.data.comments.total)},{default:s(()=>[l(t,{name:"i-heroicons-chat-bubble-oval-left-ellipsis"}),r[5]||(r[5]=b(" Load Previous Comments "))]),_:1})):F("",!0),a("div",Se,[(p(!0),S(ye,null,xe(oe(h),e=>(p(),S("div",{key:e,class:"w-full"},[e.is_facilitator?(p(),S("div",Fe,[l($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-ful bg-gray-100"},{default:s(()=>[a("div",De,[l(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",Ve,[r[7]||(r[7]=a("span",{class:"font-semibold text-primary"}," You ",-1)),l(v,{variant:"soft",size:"xs",color:"blue"},{default:s(()=>r[6]||(r[6]=[a("span",{class:"capitalize"}," Faciliator ",-1)])),_:1})])]),a("div",ze,x(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(p(),k(u,{key:0,color:"green",variant:"soft",onClick:I=>V(e.file_url)},{default:s(()=>[l(t,{name:"i-heroicons-arrow-down-tray"}),r[8]||(r[8]=b(" Attached File "))]),_:2},1032,["onClick"])):F("",!0),a("span",Ie,x(j(new Date(e.time),{addSuffix:!0})),1)],2)]),_:2},1024)])):(p(),S("div",Pe,[l($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-4"}},class:"flex gap-4 items-center w-full"},{default:s(()=>[a("div",Re,[l(y,{alt:e.user.fullname,src:e.user.photo,size:"md",imgClass:"object-cover"},null,8,["alt","src"]),a("div",Te,[a("span",Ae,x(e.user.fullname),1)])]),a("div",Be,x(e.message),1),a("div",{class:te(["flex items-center",e.file_url?"justify-between":"justify-end"])},[e.file_url?(p(),k(u,{key:0,color:"green",variant:"soft",onClick:I=>V(e.file_url)},{default:s(()=>[l(t,{name:"i-heroicons-arrow-down-tray"}),r[9]||(r[9]=b(" Attached File "))]),_:2},1032,["onClick"])):F("",!0),a("span",Le,x(j(new Date(e.time))),1)],2)]),_:2},1024)]))]))),128))])]),l($,{ui:{body:{base:"w-full",padding:"p-4 sm:p-2"}},class:"flex gap-4 items-center w-full"},{default:s(()=>[l(z,{modelValue:f.value.message,"onUpdate:modelValue":r[1]||(r[1]=e=>f.value.message=e),class:"w-full mb-2",placeholder:"Add Comment...",variant:"none"},null,8,["modelValue"]),a("div",Ne,[l(R,{"is-display-file":!1,accept:"*","max-size":"6291456",onFileUploaded:P}),l(u,{color:"primary",onClick:r[2]||(r[2]=e=>B(f.value))},{default:s(()=>[l(t,{name:"i-heroicons-paper-airplane"}),r[10]||(r[10]=b(" Send "))]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},He=""+new URL("meeting.Myzv2aiY.svg",import.meta.url).href,Ee={class:"flex justify-between items-center w-full border-b border-1 pb-4"},We={class:"flex flex-col w-full h-full my-4"},Ye={class:"flex flex-col"},Je={class:"flex gap-2 justify-center items-center p-4"},Qe={class:"flex justify-center gap-2"},Ge={class:"flex flex-col items-center"},Ke=["src"],Xe={class:"flex gap-2 justify-center items-center p-4 font-semibold text-lg"},Ze={class:"flex justify-center gap-2"},et={class:"w-full flex justify-end"},tt={__name:"UploadResultSidebar",props:{isOpen:{type:Boolean,default:!1},data:{type:Object}},emits:["update:isOpen","hide","refresh"],setup(N,{emit:T}){const{updateMerchantOrder:A}=Z();J(),Q();const O=G(),c=N,U=T,g=m(c.isOpen);D(()=>c.isOpen,o=>{g.value=o,o||C()}),D(g,o=>{U("update:isOpen",o)});const C=()=>{g.value=!1,h.value=!1,_.value=!1,f.value={result_file_url:"",meet_url:""},U("hide")},f=m({result_file_url:"",meet_url:""}),h=m(!1),_=m(!1),w=m({title:"",message:"",callback:null}),j=o=>{f.value.result_file_url=o},P=(o,t,u,y,v)=>{w.value={title:o,content:t,confirmText:u,cancelText:y,callback:v},h.value=!0},V=o=>{window.open(o,"_blank")},M=o=>{navigator.clipboard.writeText(o),O.add({title:"Copied!",color:"green",icon:"i-heroicons-check-circle",description:"Meeting URL copied to clipboard!"})},B=o=>{M(o),V(o)};D(()=>c.data,o=>{o&&o.actions&&o.actions.meet_url&&(f.value.meet_url=o.actions.meet_url)},{immediate:!0,deep:!0});const d=o=>{const t={};for(const u in o)o[u]!==""&&o[u]!==null&&o[u]!==void 0&&(t[u]=o[u]);return t},r=async()=>{const o=c.data.actions.id;try{const{data:t}=await A(o,d({result_file_url:f.value.result_file_url,meet_url:f.value.meet_url}));O.add({title:"Success!",color:"green",icon:"i-heroicons-check-circle",description:"Order updated successfully!"}),C()}catch(t){console.error("Updating order failed:",t),O.add({title:"Failed!",color:"red",icon:"i-heroicons-x-circle",description:"Failed to update order!"})}};return(o,t)=>{const u=X,y=re,v=Y,$=K,z=se,R=le,i=ue;return p(),k(i,{modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=e=>g.value=e),fullscreen:"","prevent-close":"",ui:{base:"!w-[600px] absolute top-0 right-0 h-screen bg-white dark:bg-gray-800 rounded-l-3xl",rounded:"rounded-l-3xl rounded-r-0"}},{default:s(()=>[l(v,{ui:{base:"h-full ",ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",rounded:"rounded-l-3xl rounded-r-0",body:{base:"flex flex-col justify-between h-full",padding:"px-6 py-5 sm:p-10"},header:{padding:"px-6 py-5 sm:px-8"},footer:{padding:"px-6 py-4 sm:px-10"}}},{default:s(()=>[a("div",Ee,[a("button",{onClick:C},[l(u,{name:"back",class:"text-2xl text-primary dark:text-gray-300"})]),t[6]||(t[6]=a("h3",{class:"text-lg font-semibold w-full flex justify-center text-primary"}," Upload Result ",-1))]),a("div",We,[t[12]||(t[12]=a("span",{class:"font-semibold py-4"}," Work Result ",-1)),!c.data.actions.result_file_url||_.value?(p(),k(v,{key:0,ui:{base:"w-full h-[200px] border-dashed border-2",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[l(y,{title:"Result",accept:"*",center:!0,"max-size":"6291456",onFileUploaded:j})]),_:1},512)):(p(),k(v,{key:1,ui:{base:"w-full h-[200px] ",body:{base:"w-full h-[200px] flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[a("div",Ye,[a("div",Je,[l(u,{name:"file"}),t[7]||(t[7]=b(" Your Past Result "))]),a("div",Qe,[l($,{icon:"i-heroicons-arrow-up-tray",onClick:t[0]||(t[0]=e=>P("Hang On","Are you sure you want to reupload this result?","Re Upload","Cancel",()=>_.value=!0))},{default:s(()=>t[8]||(t[8]=[b(" Reupload ")])),_:1}),l($,{icon:"i-heroicons-arrow-down-tray",onClick:t[1]||(t[1]=e=>V(c.data.actions.result_file_url))},{default:s(()=>t[9]||(t[9]=[b(" Download ")])),_:1})])])]),_:1},512)),t[13]||(t[13]=a("span",{class:"font-semibold py-4"}," Setup a Meeting ",-1)),l(v,{ui:{base:"w-full ",body:{base:"flex justify-center items-center"}},ref:"dropzone-file"},{default:s(()=>[a("div",Ge,[a("img",{src:oe(He),width:"200px",alt:""},null,8,Ke),a("div",Xe,[l(z,{name:"i-heroicons-video-camera"}),t[10]||(t[10]=b(" Meeting Link "))]),a("div",Ze,[l(R,{modelValue:f.value.meet_url,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value.meet_url=e)},null,8,["modelValue"]),c.data.actions.meet_url?(p(),k($,{key:0,color:"primary",onClick:t[3]||(t[3]=e=>B(f.value.meet_url))},{default:s(()=>[l(z,{name:"i-heroicons-video-camera"}),t[11]||(t[11]=b(" Open "))]),_:1})):F("",!0)])])]),_:1},512)]),a("div",et,[l($,{color:"primary",onClick:t[4]||(t[4]=e=>r())},{default:s(()=>[l(u,{name:"floppy"}),t[14]||(t[14]=b(" Save "))]),_:1})])]),_:1}),l(ie,{isOpen:h.value,data:w.value},null,8,["isOpen","data"])]),_:1},8,["modelValue"])}}},lt={class:"pt-0 p-6 flex flex-col gap-2"},at={class:"flex gap-2"},ot={key:0,class:"flex flex-col gap-1 items-start capitalize"},st={class:"text-primary"},nt={key:1,class:"text-gray-300"},it={class:"text-primary"},rt={class:"text-primary"},ut={class:"flex gap-3 items-center"},dt={class:"flex flex-col"},ct={class:"font-semibold text-primary"},pt={class:"text-sm text-gray-600"},mt={key:1,class:"text-gray-300"},ft={class:"flex gap-1"},_t="Order List",It={__name:"orders",setup(N){const{getMyMerchantOrders:T}=Z();G(),Q();const A=J(),O=m(!0),c=m(!1),U=m(!1),g=m(!1),C=m({title:"",message:"",callback:null});m([]);const f=m([]),h=m({label:"All",value:"all"}),_=m(null),w=m(""),j=m(1),P=m({page:1,totalPage:1,totalItems:0,itemsPerPage:10}),V=[{label:"All",value:"all",color:"gray"},{label:"Completed",value:"completed",color:"orange"},{label:"Paid",value:"paid",color:"blue"},{label:"Pending",value:"pending",color:"orange"},{label:"Waiting Payment",value:"waitingpaid",color:"orange"},{label:"Failed",value:"failed",color:"orange"}],M=async()=>{try{await T({page:j.value,per_page:P.value.itemsPerPage,order_status:h.value.value==="all"?"":h.value.value,search:w.value}).then(i=>{f.value=i.data.data.orders.data.map((e,I)=>({no:I+1,service:{id:e.service.id,name:e.merchant.type,type:e.service.type},client:{id:e.user.id,fullname:e.user.fullname,email:e.user.email},"Order Date":o(e.created_at,"dd MMM yyyy"),"Delivery Address":e.is_hardfile??"-",estimated:`${e.service.time_estimated} ${e.service.time_estimated_unit}`,languages:{language_source:e.language_source,language_destination:e.language_destination},price:e.price,comments:{total:t(e.comment_json)?e.comment_json.length:0,data:e.comment_json||[]},status:e.order_status,file:e.user_file_url,actions:{id:e.id,status:e.order_status,result_file_url:e.result_file_url,meet_url:e.meet_url}}))})}catch(i){console.error("Error fetching merchant orders:",i)}finally{O.value=!1}};D(j,M),D(h,()=>{M()},{deep:!0}),D(w,we(()=>{M()},300));const B=()=>{M(j.value,h.value.value,w.value)},d=i=>{window.open(i,"_blank")},r=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(i),o=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"}),t=i=>{try{return JSON.parse(i)}catch{return i}},u=i=>{_.value=i,console.log("Refreshed data:",_)},y=()=>{U.value=!1,g.value=!1,M()},v=(i,e,I,E,q)=>{C.value={title:i,content:e,confirmText:I,cancelText:E,callback:q},c.value=!0},$=i=>{_.value=i,U.value=!0},z=i=>{_.value=i,g.value=!0},R=i=>{switch(i){case"completed":return{color:"green",text:"Completed"};case"paid":return{color:"blue",text:"In Progress"};case"pending":return{color:"violet",text:"Pending"};case"waitingpaid":return{color:"orange",text:"Waiting"};case"failed":return{color:"red",text:"Failed"};default:return{color:"gray",text:"Unknown"}}};return be(()=>{const i=A.query.detail_id;i&&(w.value=i),M()}),(i,e)=>{const I=_e,E=le,q=Y,ee=ae,de=ne,L=K,ce=X,W=ke,pe=$e,me=Ce,fe=he;return p(),S("div",null,[l(fe,{name:"merchant"},{default:s(()=>[a("div",lt,[l(q,{ui:{body:{base:"flex justify-between items-center w-full",background:"",padding:"p-2 sm:p-4"}}},{default:s(()=>[a("h6",{class:"font-semibold"},x(_t)),a("div",at,[l(I,{options:V,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=n=>h.value=n),placeholder:"Pilih Status",by:"value","option-attribute":"label","search-attributes":["label"],onChange:B,class:"max-w-[180px]"},null,8,["modelValue"]),l(E,{icon:"i-heroicons-magnifying-glass-20-solid",size:"sm",color:"white",trailing:!1,placeholder:"Search Order",modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=n=>w.value=n)},null,8,["modelValue"])])]),_:1}),l(q,{ui:{body:{base:"flex flex-col gap-4"}}},{default:s(()=>[l(pe,{rows:f.value,loading:O.value,"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Loading..."},ui:{wrapper:"max-w-full relative overflow-x-auto",base:" table-fixed overflow-x-auto"}},{"service-data":s(({row:n})=>[n.service?(p(),S("div",ot,[a("span",st,x(n.service.name)+" Service ",1),l(ee,{variant:"soft",color:"orange",class:"capitalize"},{default:s(()=>[b(x(n.service.type),1)]),_:2},1024)])):(p(),S("span",nt," Kosong "))]),"price-data":s(({row:n})=>[a("span",it,x(r(n.price)),1)]),"languages-data":s(({row:n})=>[a("span",rt,x(n.languages.language_source.name)+" -> "+x(n.languages.language_destination.name),1)]),"client-data":s(({row:n})=>[a("div",ut,[l(de,{src:n.client.photo,alt:n.client.fullname,size:"sm",variant:"rounded-full",imgClass:"object-cover"},null,8,["src","alt"]),a("div",dt,[a("span",ct,x(n.client.fullname),1),a("span",pt,x(n.client.email),1)])])]),"comments-data":s(({row:n})=>[l(L,{size:"sm",color:"blue",variant:"soft",trailing:!1,onClick:H=>$(n)},{default:s(()=>[b(x(n.comments.total)+" Comments ",1)]),_:2},1032,["onClick"])]),"status-data":s(({row:n})=>[l(ee,{size:"xs",label:R(n.status).text,color:R(n.status).color,variant:"subtle",class:"capitalize"},null,8,["label","color"])]),"file-data":s(({row:n})=>[n.file?(p(),k(L,{key:0,size:"sm",color:"primary",trailing:!1,onClick:H=>d(n.file)},{default:s(()=>[l(ce,{name:"file",class:"text-white"}),e[3]||(e[3]=b(" Open Client File "))]),_:2},1032,["onClick"])):(p(),S("span",mt," No File Uploaded "))]),"actions-data":s(({row:n})=>[a("div",ft,[n.actions.status==="pending"?(p(),k(W,{key:0,text:"Accept Order"},{default:s(()=>[l(L,{icon:"i-heroicons-check",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>v("Hang On","Are you sure you want to accept this order?","Accept Order","Cancel",()=>{i.updateUserStatus(n.user.id,"waitingpaid")})},null,8,["onClick"])]),_:2},1024)):F("",!0),n.actions.status==="paid"?(p(),k(W,{key:1,text:"Upload Works"},{default:s(()=>[l(L,{icon:"i-heroicons-arrow-up-tray",size:"2xs",color:"green",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>z(n)},null,8,["onClick"])]),_:2},1024)):F("",!0),n.actions.status==="completed"?(p(),k(W,{key:2,text:"Check Result"},{default:s(()=>[l(L,{icon:"i-heroicons-arrow-top-right-on-square",size:"2xs",color:"blue",variant:"outline",ui:{rounded:"rounded-full"},square:"",onClick:H=>z(n)},null,8,["onClick"])]),_:2},1024)):F("",!0)])]),_:1},8,["rows","loading"]),l(me,{modelValue:j.value,"onUpdate:modelValue":e[2]||(e[2]=n=>j.value=n),"page-count":1,total:P.value.totalPage},null,8,["modelValue","total"])]),_:1})])]),_:1}),l(ie,{isOpen:c.value,data:C.value},null,8,["isOpen","data"]),l(qe,{isOpen:U.value,data:_.value,onHide:y,onRefresh:u},null,8,["isOpen","data"]),l(tt,{isOpen:g.value,data:_.value,onHide:y,onRefresh:u},null,8,["isOpen","data"])])}}};export{It as default};
